{% extends "base.html.twig" %}
{% block title %}
    Settings
{% endblock title %}
{% block content %}

    <div class="">
        <div class="" style="margin-top: -25px;">
            {{ include('partials/_row_title_block.html.twig', {main_title: 'Looking to change things?', sub_title: 'Here\'s the necessary configurations for tweaking your Edgebox experience.'})}}
            <div class="row" style="margin-top: -25px;">
                {# <div class="col-12 col-xl-4" style="margin-top: 25px;">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">Basic Information</h6>
                        </div>
                        <div class="card-body p-3">
                            <p class="text-sm opacity-8">The following information helps Edgebox create a personalized experience for you.</p>
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">About you</h6>
                            <ul class="list-group">
                                <li class="list-group-item border-0 px-0">
                                    <div class="row">
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <div class="input-group input-group-alternative mb-4">
                                                    <span class="input-group-text"><i class="ni ni-badge"></i></span>
                                                    <input class="form-control form-control-alternative" placeholder="Name" type="text">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <div class="input-group input-group-alternative mb-4">
                                                    <span class="input-group-text"><i class="ni ni-email-83"></i></span>
                                                    <input class="form-control form-control-alternative" placeholder="Email" type="text">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <button class="btn btn-outline-secondary">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder mt-0">Edgebox.io Account</h6>
                            <p><span class="badge badge-pill badge-lg {% if not show_form and connection_details.node_name != "Unavailable" %}bg-gradient-success{% else %}bg-gradient-secondary{% endif %}">{{ status }}</span></p>
                            {% if (alert is not empty and alert.alert == 'edgeboxio_login') %}

                                <div class="alert alert-{{ alert.type }} alert-dismissible fade show" role="alert" style="color: white;">
                                    <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                                    <span class="alert-text"><strong>
                                        {% if alert.type == 'success' %}
                                            Login successful!
                                        {% elseif alert.type == 'warning' %}
                                            Login Error. Please re-check credentials.
                                        {% else %}
                                            Unknown error ocurred. Please try again.
                                        {% endif %}
                                    </strong></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                            {% endif %}
                            {% if show_form %}
                                <li class="list-group-item border-0 px-0">
                                <p class="text-sm opacity-8">
                                    <b>Connect your <a target="_blank" href="https://edgebox.io">Edgebox.io</a> Account</b> to enjoy seamless integration with backup and access services.
                                    <br>
                                <form action="" method="POST">
                                    <input type="hidden" name="setting" value="edgeboxio_login">
                                    <div class="form-group">
                                        <label for="username">Username:</label>
                                        <input type="text" class="form-control" name="username" id="edgeboxio-username" placeholder="">
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password: </label>
                                        <input type="password" class="form-control" name="password" id="edgeboxio-password">
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-outline-secondary">Login & Setup</button>
                                    </div>
                                </form>
                            {% else %}
                                <ul class="list-group">
                                <li class="list-group-item border-0 px-0">
                                    <div class="form-check form-switch ps-0">
                                        <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault3" disabled>
                                        <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="flexSwitchCheckDefault3">Auto-renew connection</label>
                                    </div>
                                </li>
                                </ul>
                                <a href="/settings/logout"><button class="btn btn-outline-secondary">Logout</button></a>

                            {% endif %}

                        </div>
                    </div>
                </div> #}

                <div class="col-12 col-xl-4" style="margin-top: 25px;">
                    <div class="card">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">Dashboard Behavior</h6>
                        </div>
                        <div class="card-body p-3">
                            <p class="text-sm opacity-8">Configure the dashboard with visual tweaks and functional settings.</p>
                            <!-- Sidebar Backgrounds -->
                            <hr>
                            <div>
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Color Mood</h6>
                            <p class="text-xs">Set a color accent mood across the interface.</p>
                            </div>
                            <a href="javascript:void(0)" class="switch-trigger background-color">
                            <div class="badge-colors my-2 text-start color-mood-picker">
                                <span class="badge filter bg-gradient-primary {% if dashboard_settings.color_mood == "primary" %}active{% endif %}" data-color="primary" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-dark {% if dashboard_settings.color_mood == "dark" %}active{% endif %}" data-color="dark" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-info {% if dashboard_settings.color_mood == "info" %}active{% endif %}" data-color="info" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-success {% if dashboard_settings.color_mood == "success" %}active{% endif %}" data-color="success" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-warning {% if dashboard_settings.color_mood == "warning" %}active{% endif %}" data-color="warning" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-danger {% if dashboard_settings.color_mood == "danger" %}active{% endif %}" data-color="danger" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                            </div>
                            </a>
                            <!-- Sidenav Type -->
                            <hr>
                            <div class="mt-3">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Sidebar style</h6>
                            <p class="text-xs">Choose between 2 different side navigation types.</p>
                            </div>
                            <div class="d-flex">
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">Transparent</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsNavbarFixed" data-class="{{ dashboard_settings.sidebar_style }}" onclick="changeDataClassForSideBarType(this); sidebarType(this); saveSidebarStyle(this);" {% if dashboard_settings.sidebar_style == "bg-white" %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">White</label>
                            </div>
                            </div>
                            <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
                            <!-- Navbar Fixed -->
                            <hr>
                            <div class="mt-3">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Topbar style</h6>
                            </div>
                            <p class="text-xs">Choose if the title bar should float or stay in place when you scroll through the dashboard.</p>
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">Floating</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsTitleBarFloating" data-class="bg-white" onclick="navbarFloating(this); saveTopbarStyle(this);" {% if(dashboard_settings.topbar_style == "fixed") %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">Fixed</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-xl-8" style="margin-top: 25px;">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">External Access</h6>
                        </div>
                        <div class="card-body p-3">

                            {% if (alert is not empty and alert.alert == 'remove_custom_domain') %}

                                <div class="alert alert-{{ alert.type }} alert-dismissible fade show" role="alert" style="color: white;">
                                    <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                                    <span class="alert-text"><strong>
                                        {% if alert.type == 'success' %}
                                            Custom Domain Removed
                                        {% else %}
                                            Unknown error ocurred. Please try again.
                                        {% endif %}
                                    </strong></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                            {% endif %}

                            <p class="text-sm opacity-8">Configure 1-click internet access to your apps and dashboard. Logging in with a Cloudflare account gives your a frictionless experience. Manual Setup requires you to configure a connection yourself.</p>
                            
                            <hr>
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Domain Name Configuration</h6>
                            <div class="nav-wrapper position-relative end-0">
                                <ul class="nav nav-pills nav-fill p-1" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <a href="#" class="nav-link mb-0 px-0 py-1 {% if domain_name_config_step == "0" %}active{% endif %}" id="pills-edgeboxio-account-tab" data-bs-toggle="pill" data-bs-target="#pills-edgeboxio-account" role="tab" aria-controls="pills-edgeboxio-account" aria-selected="{% if domain_name_config_step == "0" %}true{% else %}false{% endif %}">
                                        <b>Cloudflare</b>
                                        </a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a href="#" class="nav-link mb-0 px-0 py-1 {% if domain_name_config_step == "1" %}active{% endif %}" data-bs-toggle="pill" data-bs-target="#pills-custom-domain" role="tab" aria-controls="pills-custom-domain" aria-selected="{% if domain_name_config_step == "0" %}false{% else %}true{% endif %}">
                                        <b>Manual Setup</b>
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content" id="pills-tabContent">
                                    <div class="tab-pane fade {% if domain_name_config_step == "0" %}show active{% endif %}" id="pills-edgeboxio-account" role="tabpanel" aria-labelledby="pills-edgeboxio-account-tab">
                                        <br>
                                            {% if show_form and domain_name_config_step == '0' %}
                                                <p class="text-sm opacity-8">
                                                    <b>Configure Edgebox to allow receiving connections through Cloudflare.</b> Edgebox connects seamlessly with CloudFlare and your domain name, and will be running a secure connection in seconds, and making sure it is available. You can <a href="https://www.cloudflare.com/products/registrar/" target="_blank">buy a domain name</a> or <a href="https://developers.cloudflare.com/fundamentals/get-started/setup/add-site/" target="_blank">use one you already own.</a> You must have a domain configured with Cloudflare before continuing.
                                                </p>
                                                <br>
                                                <p class="text-sm opacity-8">
                                                    <button type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="setupCloudflare(this);">Start Connection with CloudFlare</button>
                                                    <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -25px;">
                                                        <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                        <span class="alert-text text-xs text-white"><i>Once you click, wait a few seconds while the connection is prepared. A new tab will open where you can authenticate and choose the domain name you want to configure for this box.</i></span>
                                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                            <span aria-hidden="true"></span>
                                                        </button>
                                                    </div>
                                                </p>

                                            {% elseif domain_name_config_step == "1"%}

                                                <p class="text-sm opacity-8">
                                                    <br>
                                                    <br>
                                                    <div class="py-3 text-center">
                                                        <i class="ni ni-button-power ni-3x"></i>
                                                        <h4 class="text-gradient text-warning mt-4">Custom Domain is Active</h4>
                                                        <p>To use a <a target="_blank" href="https://cloudflare.com">Cloudflare Tunnel</a> to access your edgebox from the internet, you cannot be using a custom domain name. Remove it first and try again.</p>
                                                    </div>
                                                    <br>
                                                    <br>
                                                </p>

                                            {% else %}
                                                <p class="text-sm opacity-8"><b>Connection status:</b> {{ connection_status }}</p>
                                                <p class="text-sm opacity-8"><b>Connection details:</b></p>
                                                <p>
                                                    <ul id="connection-details">
                                                        {% for key,item in connection_details %}
                                                            {% if key != "login_link" %}<li>{{ key }}: {{ item }}</li>{% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </p>
                                                {% if task_status < 2 %}
                                                    {% if connection_details.status == "waiting" %}
                                                        <p class="text-sm opacity-8">
                                                            <a href="{{connection_details.login_link}}" target="_blank" type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="continueCloudFlare(this);">Login with CloudFlare</a>
                                                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -25px;">
                                                                <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                                <span class="alert-text text-xs text-white"><i>Click the button to open a CloudFlare page where you can login. The process will automatically proceed.</i></span>
                                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                                    <span aria-hidden="true"></span>
                                                                </button>
                                                            </div>
                                                        </p>
                                                    {% else %}
                                                        <p class="text-sm opacity-8">
                                                            <button type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="setupCloudflare(this);">Retry Connection with CloudFlare</button>
                                                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -25px;">
                                                                <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                                <span class="alert-text text-xs text-white"><i>Once you click, wait a few seconds while the connection is prepared. A new tab will open where you can authenticate and choose the domain name you want to configure for this box.</i></span>
                                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                                    <span aria-hidden="true"></span>
                                                                </button>
                                                            </div>
                                                        </p>
                                                    {% endif %}
                                                {% endif %}
                                            {% endif %}

                                    </div>
                                    <hr>
                                    <div class="tab-pane fade {% if domain_name_config_step == "1" %}show active{% endif %}" id="pills-custom-domain" role="tabpanel" aria-labelledby="pills-custom-domain-tab">
                                        <br>
                                        <p class="text-sm opacity-8">
                                            <b>Configure Edgebox to allow receiving connections through a custom domain name you own.</b> This is an advanced setting and requires you to know how to setup a domain name and potentially how to configure security certificates.
                                        </p>
                                        <br>

                                        {% if (alert is not empty and alert.alert == 'custom_domain') %}

                                            <div class="alert alert-{{ alert.type }} alert-dismissible fade show" role="alert" style="color: white;">
                                                <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                                                <span class="alert-text"><strong>
                                                    {% if alert.type == 'success' %}
                                                        Domain setup!
                                                    {% elseif alert.type == 'warning' %}
                                                        Problem. Domain not valid.
                                                    {% else %}
                                                        Unknown error ocurred. Please try again.
                                                    {% endif %}
                                                </strong></span>
                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>

                                        {% endif %}
                                        
                                        {% if domain_name_config_step == "0" %}
                                            <p class="text-sm opacity-8">
                                                <b>Step 1: </b>Insert the domain name below (for example "mydomain.com"). Edgebox will configure itself to accept connections from this domain.
                                            </p>
                                            <form action="" method="POST">
                                                <input type="hidden" name="setting" value="custom_domain">
                                                <div class="form-group">
                                                    <label for="custom-domain-domain" class="form-control-label">Domain name:</label>
                                                    <input class="form-control" name="domain" type="text" value="" id="custom-domain-domain">
                                                </div>
                                                <div class="form-group">
                                                    <button class="btn btn-outline-secondary">Continue</button>
                                                </div>
                                            </form>
                                        {% endif %}
                                        
                                        {% if domain_name_config_step != "0" %}
                                            <p class="text-sm opacity-8">
                                                <b class="text-success" >Step 1: </b>Add domain name (<b>{{domain_name}}</b>) ✔️
                                            </p>
                                            <p class="text-sm opacity-8">
                                                <b>Step 2: </b>Go to the domain name control panel of your provider, and set the following records:                                                
                                                <div class="card">
                                                    <div class="table-responsive">
                                                        <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Type</th>
                                                            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Value</th>
                                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Destination</th>
                                                            {# <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th> #}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            
                                                            <tr>
                                                            <td>
                                                                <div class="d-flex px-2 py-1">
                                                                <div class="d-flex flex-column justify-content-center">
                                                                    <h6 class="mb-0 text-xs">A</h6>
                                                                </div>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <p class="text-xs font-weight-bold mb-0">@</p>
                                                            </td>
                                                            <td class="align-middle text-center">
                                                                <span class="text-secondary text-xs font-weight-bold">{{ip_address}}</span>
                                                            </td>
                                                            {# <td class="align-middle text-center text-sm">
                                                                <span class="badge badge-sm badge-success">Online</span>
                                                            </td> #}
                                                            </tr>

                                                            {% for appkey,appinfo in apps_list %}
                                                                {% if appinfo.status.description == 'on' or appinfo.status.description == 'off' %}
                                                                <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                    <div class="d-flex flex-column justify-content-center">
                                                                        <h6 class="mb-0 text-xs">A</h6>
                                                                    </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">{{appinfo.id}}.{{domain_name}}</p>
                                                                </td>
                                                                <td class="align-middle text-center">
                                                                    <span class="text-secondary text-xs font-weight-bold">{{ip_address}}</span>
                                                                </td>
                                                                {# <td class="align-middle text-center text-sm">
                                                                    <span class="badge badge-sm bg-success">Online</span>
                                                                </td> #}
                                                                </tr>
                                                                {% endif %}
                                                            {% endfor %}

                                                        </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <br>
                                                <br>

                                                <i class="text-sm opacity-8"><b>Note:</b> You only need to set A records for the EdgeApps you want to access online. When possible to setup a wildcard subdomain, you can do so as well.</i>
                                            </p>
                                            <p class="text-sm opacity-8">
                                                <b {% if apps_online > 0 %}class="text-success"{% endif %}>Step 3: </b>Go to the EdgeApps screen and switch online access to each individual app you want accessible. {% if apps_online > 0 %}✔️{% endif %}
                                            </p>
                                            <br>
                                            <form action="" method="POST">
                                                <input type="hidden" name="setting" value="remove_custom_domain">
                                                <div class="form-group">
                                                    <button class="btn btn-outline-danger">Remove Custom Domain</button>
                                                </div>
                                            </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Dashboard Public Access</h6>
                            <p class="text-sm opacity-8">Toggle between being able to access this dashboard via the internet, or only inside your home network.</p>
                            {% if release_version != 'cloud' %}
                                {% if show_form and domain_name_config_step == '0' %}
                                    <p class="text-sm opacity-8">
                                        <br>
                                        <br>
                                        <div class="py-3 text-center">
                                            <h4 class="text-gradient text-warning mt-4">First things first...</h4>
                                            <p>To provide access to your dashboard through the internet, please setup the "domain name configuration" first.</b></p>
                                        </div>
                                        <br>
                                        <br>
                                    </p>
                                {% else %}
                                    {% if is_dashboard_public %}
                                        <div class="row">
                                            <div class="col-4">
                                                <a href="/settings/disable_public_dashboard" class="btn btn-outline-danger">Disable</a>
                                            </div>
                                            <div class="col-8">
                                                <p class="text-sm opacity-8 text-success" style="margin-top: 8px;"><i class="fas fa-check"></i>  Available via <a href="https://{{dash_internet_url}}/" target="_blank">{{dash_internet_url}}</a></p>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="row">
                                            <div class="col-4">
                                                <a href="/settings/enable_public_dashboard" class="btn btn-outline-success">Enable</a>
                                            </div>
                                            <div class="col-8">
                                                <p class="text-sm opacity-8" style="margin-top: 8px;"><i class="fas fa-home"></i>  Currently only acessible in home-network</p>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                <div class="row">
                                    <div class="col-4">
                                        <button type="button" class="btn btn-outline-light" >Disable</button>
                                    </div>
                                    <div class="col-8">
                                        <p class="text-sm opacity-8" style="margin-top: 8px;"><i class="fas fa-exclamation-triangle"></i>  Only available in the <a href="https://edgebox.io/product" target="_blank">self-hosted verisn</a></p>
                                    </div>
                                </div>
                            {% endif %}

                        </div>
                        {# <div class="card-body p-3">
                            <p class="text-sm opacity-8">The following settings help you take action on setting up advanced features.</p>
                            
                        </div> #}
                    </div>
                </div>

                

                {# <div class="col-12 col-xl-4" style="margin-top: 25px;">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">System Information</h6>
                        </div>
                        <div class="card-body p-3">
                            <ul class="list-group">
                                <li class="list-group-item border-0 px-0">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="card bg-cover text-center" style="background-image: url('/assets/img/coming-soon-bg.jpg')">
                                                <div class="card-body z-index-2 py-9">
                                                    <h4 class="text-white">Coming Soon</h2>
                                                        <p class="text-white">
                                                            Your current version still does not support this feature. We are working to bring it as fast as possible. <a href="https://github.com/edgebox-iot/contribute" target="_blank">Want to help? You can!</a>
                                                        </p>
                                                </div>
                                                <div class="mask bg-gradient-primary border-radius-lg"></div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div> #}

            </div>
        </div>
    </div>


{% endblock content %}
