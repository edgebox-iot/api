{% extends "base.html.twig" %}
{% block title %}
    Settings
{% endblock title %}
{% block content %}

    <div class="">
        <div class="" style="margin-top: -25px;">
            {{ include('partials/_row_title_block.html.twig', {main_title: 'Looking to change things?', sub_title: 'Here\'s the necessary configurations for tweaking your Edgebox experience.'})}}
            <div class="row" style="margin-top: -25px;">
                <div class="col-12 col-xl-4" style="margin-top: 25px;">
                    <div class="card">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">Dashboard Behavior</h6>
                        </div>
                        <div class="card-body p-3">
                            <p class="text-sm opacity-8">Configure the dashboard with visual tweaks and functional settings.</p>
                            <!-- Sidebar Backgrounds -->
                            <hr>
                            <div>
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Color Mood</h6>
                            <p class="text-xs">Set a color accent mood across the interface.</p>
                            </div>
                            <a href="javascript:void(0)" class="switch-trigger background-color">
                            <div class="badge-colors my-2 text-start color-mood-picker">
                                <span class="badge filter bg-gradient-primary {% if dashboard_settings.color_mood == "primary" %}active{% endif %}" data-color="primary" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-dark {% if dashboard_settings.color_mood == "dark" %}active{% endif %}" data-color="dark" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-info {% if dashboard_settings.color_mood == "info" %}active{% endif %}" data-color="info" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-success {% if dashboard_settings.color_mood == "success" %}active{% endif %}" data-color="success" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-warning {% if dashboard_settings.color_mood == "warning" %}active{% endif %}" data-color="warning" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                                <span class="badge filter bg-gradient-danger {% if dashboard_settings.color_mood == "danger" %}active{% endif %}" data-color="danger" onclick="sidebarColorPick(this); saveColorMood(this);"></span>
                            </div>
                            </a>
                            <!-- Sidenav Type -->
                            <hr>
                            <div class="mt-3">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Sidebar style</h6>
                            <p class="text-xs">Choose between 2 different side navigation types.</p>
                            </div>
                            <div class="d-flex">
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">Transparent</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsNavbarFixed" data-class="{{ dashboard_settings.sidebar_style }}" onclick="changeDataClassForSideBarType(this); sidebarType(this); saveSidebarStyle(this);" {% if dashboard_settings.sidebar_style == "bg-white" %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">White</label>
                            </div>
                            </div>
                            <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
                            <!-- Navbar Fixed -->
                            <hr>
                            <div class="mt-3">
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder">Topbar style</h6>
                            </div>
                            <p class="text-xs">Choose if the title bar should float or stay in place when you scroll through the dashboard.</p>
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">Floating</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsTitleBarFloating" data-class="bg-white" onclick="navbarFloating(this); saveTopbarStyle(this);" {% if(dashboard_settings.topbar_style == "fixed") %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">Fixed</label>
                            </div>
                            <!-- Show purpose labels for quick access app icons -->
                            <hr>
                            <div class="mt-3">
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder">Show app icon purpose label</h6>
                            </div>
                            <p class="text-xs">Choose if if you want to see purpose labels overalaid on top of app icons in the dashboard main page.</p>
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">No</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsAppsPurposeLabel" data-class="bg-white" onclick="saveAppsPurposeLabel(this);" {% if(dashboard_settings.show_purpose_label_on_quick_access_icons == "yes") %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">Yes</label>
                            </div>
                            <!-- Show me when it twerks -->
                            <hr>
                            <div class="mt-3">
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder">Show me when it twerks!</h6>
                            </div>
                            <p class="text-xs">If active, the 🦀 will shout <b><i>and twerk</i></b> when tasks complete.</p>
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">No</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsShowMeWhenItTwerks" data-class="bg-white" onclick="saveShowMeWhenItTwerks(this);" {% if(dashboard_settings.show_me_when_it_twerks == "yes") %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">Yes</label>
                            </div>
                            <!-- Apps Public Access -->
                            <hr>
                            <div class="mt-3">
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder">Block default apps public access</h6>
                            </div>
                            <p class="text-xs">By default, a newly installed app is automatically configured for external access.<b><i>Activate this slider</i></b> to block that behavior.</p>
                            <div class="form-check form-switch ps-0">
                                <label class="form-check-label left-aligned" for="flexSwitchCheckDefault">No</label>
                                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="settingsBlockDefaultAppsPublicAccess" data-class="bg-white" onclick="saveBlockDefaultAppsPublicAccess(this);" {% if(dashboard_settings.block_default_apps_public_access == "yes") %}checked{% endif %}>
                                <label class="form-check-label" for="flexSwitchCheckDefault">Yes</label>
                            </div>
                            <!-- Public Access -->
                            <hr>
                            <div class="mt-3">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder">Dashboard Public Access</h6>
                            </div>
                            <p class="text-xs">Toggle between being able to access this dashboard via the internet, or only inside your home network.</p>
                            {% if release_version != 'cloud' %}
                                {% if show_form and domain_name_config_step == '0' %}
                                    <p class="text-sm opacity-8">
                                        
                                        
                                            <h7 class="text-gradient text-warning mt-3">But first things first... 👉</h4>
                                            <p class="text-xs">To provide access to your dashboard through the internet, please setup the "domain name configuration" first.</b></p>
                                      
                                      
                                    </p>
                                {% else %}
                                    {% if is_dashboard_public %}
                                        <div class="row">
                                            <div class="col-4">
                                                <a href="/settings/disable_public_dashboard" class="btn btn-outline-danger">Disable</a>
                                            </div>
                                            <div class="col-8">
                                                <p class="text-sm opacity-8 text-success" style="margin-top: 8px;"><i class="fas fa-check"></i>  Available via <a href="https://{{dash_internet_url}}/" target="_blank">{{dash_internet_url}}</a></p>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="row">
                                            <div class="col-4">
                                                <a href="/settings/enable_public_dashboard" class="btn btn-outline-success">Enable</a>
                                            </div>
                                            <div class="col-8">
                                                <p class="text-sm opacity-8" style="margin-top: 8px;"><i class="fas fa-home"></i>  Currently only acessible in home-network</p>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                <div class="row">
                                    <div class="col-4">
                                        <button type="button" class="btn btn-outline-light" >Disable</button>
                                    </div>
                                    <div class="col-8">
                                        <p class="text-sm opacity-8" style="margin-top: 8px;"><i class="fas fa-exclamation-triangle"></i>  Only available in the <a href="https://edgebox.io/product" target="_blank">self-hosted version</a></p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="col-12 col-xl-8" style="margin-top: 25px;">
                    <div class="card">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">External Access</h6>
                            <p class="text-sm opacity-8">Click any of the titles below to see its option details.</p>

                            {% if (alert is not empty and alert.alert == 'remove_custom_domain') %}

                                <div class="alert alert-{{ alert.type }} alert-dismissible fade show" role="alert" style="color: white;">
                                    <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                                    <span class="alert-text"><strong>
                                        {% if alert.type == 'success' %}
                                            Custom Domain Removed
                                        {% else %}
                                            Unknown error ocurred. Please try again.
                                        {% endif %}
                                    </strong></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true"></span>
                                    </button>
                                </div>

                            {% endif %}

                        </div>

                        {% embed 'blocks/_collapse_card.html.twig' with { 
                            'title': 'Domain Name Configuration',
                            'collapse_id': 'collapseDomainOptions',
                            'is_collapsed': (tunnel_status_code != "waiting" and tunnel_status_code != "starting") or app.request.query.get('option_changed') != 'external_access', 
                        } %}
                            {% block card_header %}
                                <p class="text-sm opacity-8">
                                    <b>Configure 1-click internet access to your apps and dashboard</b>. Logging in with a Cloudflare account gives your a frictionless experience. Manual Setup requires you to configure a connection yourself.
                                </p>
                            {% endblock %}
                            {% block card_content %}
                                <div class="nav-wrapper position-relative end-0">
                                    <ul class="nav nav-pills nav-fill p-1" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a href="#" class="nav-link mb-0 px-0 py-1 {% if domain_name_config_step == "0" or domain_name_config_step == "2" %}active{% endif %}" id="pills-edgeboxio-account-tab" data-bs-toggle="pill" data-bs-target="#pills-edgeboxio-account" role="tab" aria-controls="pills-edgeboxio-account" aria-selected="{% if domain_name_config_step == "0" or domain_name_config_step == "2" %}true{% else %}false{% endif %}">
                                            <b>Cloudflare</b>
                                            </a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a href="#" class="nav-link mb-0 px-0 py-1 {% if domain_name_config_step == "1" %}active{% endif %}" data-bs-toggle="pill" data-bs-target="#pills-custom-domain" role="tab" aria-controls="pills-custom-domain" aria-selected="{% if domain_name_config_step == "0" or domain_name_config_step == 2 %}false{% else %}true{% endif %}">
                                            <b>Manual Setup</b>
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="pills-tabContent">
                                        <div class="tab-pane fade {% if domain_name_config_step == "0" or domain_name_config_step == "2" %}show active{% endif %}" id="pills-edgeboxio-account" role="tabpanel" aria-labelledby="pills-edgeboxio-account-tab">
                                            <br>
                                                {% if show_form and domain_name_config_step == '0' %}
                                                    <p class="text-sm opacity-8">
                                                        <b>Configure Edgebox to allow receiving connections through Cloudflare.</b> Edgebox connects seamlessly with CloudFlare and your domain name, and will be running a secure connection in seconds, and making sure it is available. You can <a href="https://www.cloudflare.com/products/registrar/" target="_blank">buy a domain name</a> or <a href="https://developers.cloudflare.com/fundamentals/get-started/setup/add-site/" target="_blank">use one you already own.</a> You must have a domain configured with Cloudflare before continuing.
                                                    </p>
                                                    <p class="text-sm opacity-8">
                                                        <div class="form-group">
                                                            <label for="custom-domain-cloudflare" class="form-control-label">Type the Domain name you are going to authorize:</label>
                                                            <input class="form-control" name="domain-cloudflare" type="text" value="" id="custom-domain-cloudflare">
                                                        </div>
                                                        <button type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="setupCloudflareTunnel(this);">Start Connection with CloudFlare</button>
                                                        <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                                            <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                            <span class="alert-text text-xs text-white"><i><b>Once you click, wait a few seconds while the connection is prepared. A new tab will open where you can authenticate and you must choose the same domain name you want to configure for this box.</i></b></span>
                                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                                <span aria-hidden="true"></span>
                                                            </button>
                                                        </div>
                                                    </p>

                                                {% elseif (domain_name_config_step == "1" or domain_name_config_step == "2") %}

                                                    <p class="text-sm opacity-8">
                                                        <br>
                                                        <br>
                                                        <div class="py-3 text-center">
                                                            <i class="ni ni-button-power ni-3x"></i>
                                                            <h4 class="text-gradient text-warning mt-4">Custom Domain is Active</h4>
                                                            <p>To use a <a target="_blank" href="https://cloudflare.com">Cloudflare Tunnel</a> to access your edgebox from the internet, you cannot be using a custom domain name. Remove it first and try again.</p>
                                                        </div>
                                                        <br>
                                                        <br>
                                                    </p>

                                                {% else %}
                                                    <p class="text-sm opacity-8"><b>Connection status:</b> {{ connection_status }}</p>
                                                    <p class="text-sm opacity-8"><b>Connection details:</b></p>
                                                    <p>
                                                        <ul id="connection-details">
                                                            {% for key,item in connection_details %}
                                                                {% if key != "login_link" %}<li>{{ key }}: {{ item }}</li>{% endif %}
                                                            {% endfor %}
                                                        </ul>
                                                    </p>
                                                    {% if task_status < 2 %}
                                                        {% if tunnel_status_code == "waiting" and connection_details.status != "expired" %}
                                                            <p class="text-sm opacity-8">
                                                                <a href="{{connection_details.login_link}}" target="_blank" type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="continueCloudFlare(this);">Login with CloudFlare</a>
                                                                <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                                                    <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                                    <span class="alert-text text-xs text-white"><i>Click the button to open a CloudFlare page where you can login. The process will automatically proceed.</i></span>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                                        <span aria-hidden="true"></span>
                                                                    </button>
                                                                </div>
                                                            </p>
                                                        {% endif %}
                                                        {% if connection_details.status == "expired" %}
                                                            <p class="text-sm opacity-8">{{connection_details.details}}</p>
                                                        {% endif %}
                                                        {% if tunnel_status_code == "error" or connection_details.status == "expired" %}
                                                            <p class="text-sm opacity-8">
                                                                <div class="form-group">
                                                                    <label for="custom-domain-cloudflare" class="form-control-label">Domain name to authorize:</label>
                                                                    <input class="form-control" name="domain-cloudflare" type="text" value="" id="custom-domain-cloudflare">
                                                                </div>
                                                                <button type="button" class="btn btn-outline-dark btn-cloudflare-connect" onclick="setupCloudflareTunnel(this);">Retry Connection with CloudFlare</button>
                                                                <div class="alert alert-warning alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                                                    <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                                                    <span class="alert-text text-xs text-white"><i><b>Once you click, wait a few seconds while the connection is prepared. A new tab will open where you can authenticate and you must choose the same domain name you want to configure for this box.</i></b></span>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                                        <span aria-hidden="true"></span>
                                                                    </button>
                                                                </div>
                                                            </p>
                                                        {% endif %}
                                                        <br>
                                                        {% if tunnel_status_code == "connected" %}
                                                            <!-- Insert some buttons here to allow the user to stop or disconnect the tunnel -->
                                                            <button type="button" class="btn btn-outline-secondary btn-cloudflare-connect" onclick="stopCloudflareTunnel(this);"><span class="btn-inner--icon" style="margin-right: 10px;"><i class="ni ni-button-pause"></i></span><span class="btn-inner--text">Stop Tunnel</span></button>
                                                            <button type="button" class="btn btn-outline-warning btn-cloudflare-connect" onclick="removeCloudflareTunnel(this);"><span class="btn-inner--icon"></span><span class="btn-inner--text">Remove Tunnel</span></button>
                                                        {% endif %}

                                                        {% if tunnel_status_code == "stopped" %}
                                                            <button type="button" class="btn btn-outline-success btn-cloudflare-connect" onclick="startCloudflareTunnel(this);"><span class="btn-inner--icon"  style="margin-right: 10px;"><i class="ni ni-button-play"></i></span><span class="btn-inner--text">Start Tunnel</span></button>
                                                            <button type="button" class="btn btn-outline-warning btn-cloudflare-connect" onclick="removeCloudflareTunnel(this);"><span class="btn-inner--icon"></span><span class="btn-inner--text">Remove Tunnel</span></button>

                                                        {% endif %}
                            
                                                    {% endif %}
                                                {% endif %}

                                        </div>
                                        <div class="tab-pane fade {% if domain_name_config_step == "1" %}show active{% endif %}" id="pills-custom-domain" role="tabpanel" aria-labelledby="pills-custom-domain-tab">
                                            <br>
                                            {% if tunnel_status_code == "not_configured" %}
                                                <p class="text-sm opacity-8">
                                                    <b>Configure Edgebox to allow receiving connections through a custom domain name you own.</b> This is an advanced setting and requires you to know how to setup a domain name and potentially how to configure security certificates.
                                                </p>
                                                <br>

                                                {% if (alert is not empty and alert.alert == 'custom_domain') %}

                                                    <div class="alert alert-{{ alert.type }} alert-dismissible fade show" role="alert" style="color: white;">
                                                        <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                                                        <span class="alert-text"><strong>
                                                            {% if alert.type == 'success' %}
                                                                Domain setup!
                                                            {% elseif alert.type == 'warning' %}
                                                                Problem. Domain not valid.
                                                            {% else %}
                                                                Unknown error ocurred. Please try again.
                                                            {% endif %}
                                                        </strong></span>
                                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>

                                                {% endif %}
                                                
                                                {% if domain_name_config_step == "0" %}
                                                    <p class="text-sm opacity-8">
                                                        <b>Step 1: </b>Insert the domain name below (for example "mydomain.com"). Edgebox will configure itself to accept connections from this domain.
                                                    </p>
                                                    <form action="" method="POST">
                                                        <input type="hidden" name="setting" value="custom_domain">
                                                        <div class="form-group">
                                                            <label for="custom-domain-domain" class="form-control-label">Domain name:</label>
                                                            <input class="form-control" name="domain" type="text" value="" id="custom-domain-domain">
                                                        </div>
                                                        <div class="form-group">
                                                            <button class="btn btn-outline-secondary">Continue</button>
                                                        </div>
                                                    </form>
                                                {% endif %}
                                                
                                                {% if domain_name_config_step != "0" %}
                                                    <p class="text-sm opacity-8">
                                                        <b class="text-success" >Step 1: </b>Add domain name (<b>{{domain_name}}</b>) ✔️
                                                    </p>
                                                    <p class="text-sm opacity-8">
                                                        <b>Step 2: </b>Go to the domain name control panel of your provider, and set the following records:                                                
                                                        <div class="card">
                                                            <div class="table-responsive">
                                                                <table class="table align-items-center mb-0">
                                                                <thead>
                                                                    <tr>
                                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Type</th>
                                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Value</th>
                                                                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Destination</th>
                                                                    {# <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th> #}
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    
                                                                    <tr>
                                                                    <td>
                                                                        <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-xs">A</h6>
                                                                        </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <p class="text-xs font-weight-bold mb-0">@</p>
                                                                    </td>
                                                                    <td class="align-middle text-center">
                                                                        <span class="text-secondary text-xs font-weight-bold">{{ip_address}}</span>
                                                                    </td>
                                                                    {# <td class="align-middle text-center text-sm">
                                                                        <span class="badge badge-sm badge-success">Online</span>
                                                                    </td> #}
                                                                    </tr>

                                                                    {% for appkey,appinfo in apps_list %}
                                                                        {% if appinfo.status.description == 'on' or appinfo.status.description == 'off' %}
                                                                        <tr>
                                                                        <td>
                                                                            <div class="d-flex px-2 py-1">
                                                                            <div class="d-flex flex-column justify-content-center">
                                                                                <h6 class="mb-0 text-xs">A</h6>
                                                                            </div>
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <p class="text-xs font-weight-bold mb-0">{{appinfo.id}}.{{domain_name}}</p>
                                                                        </td>
                                                                        <td class="align-middle text-center">
                                                                            <span class="text-secondary text-xs font-weight-bold">{{ip_address}}</span>
                                                                        </td>
                                                                        {# <td class="align-middle text-center text-sm">
                                                                            <span class="badge badge-sm bg-success">Online</span>
                                                                        </td> #}
                                                                        </tr>
                                                                        {% endif %}
                                                                    {% endfor %}

                                                                </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        <br>
                                                        <br>

                                                        <i class="text-sm opacity-8"><b>Note:</b> You only need to set A records for the EdgeApps you want to access online. When possible to setup a wildcard subdomain, you can do so as well.</i>
                                                    </p>
                                                    <p class="text-sm opacity-8">
                                                        <b {% if apps_online > 0 %}class="text-success"{% endif %}>Step 3: </b>Go to the EdgeApps screen and switch online access to each individual app you want accessible. {% if apps_online > 0 %}✔️{% endif %}
                                                    </p>
                                                    <br>
                                                    <form action="" method="POST">
                                                        <input type="hidden" name="setting" value="remove_custom_domain">
                                                        <div class="form-group">
                                                            <button class="btn btn-outline-danger">Remove Custom Domain</button>
                                                        </div>
                                                    </form>
                                                {% endif %}
                                            {% else %}
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="card bg-cover text-center" style="background-image: url('/assets/img/coming-soon-bg.jpg')">
                                                            <div class="card-body z-index-2 py-9">
                                                                <h4 class="text-white">Tunnel is Configured</h2>
                                                                    <p class="text-white">
                                                                        Please remove the tunnel configuration first to be able to do a Manual Setup</a>
                                                                    </p>
                                                            </div>
                                                            <div class="mask bg-gradient-secondary border-radius-lg"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endblock %}
                        {% endembed %}

                        {% embed 'blocks/_collapse_card.html.twig' with { 
                            'title': 'Web Shell Access',
                            'collapse_id': 'collapseShellOptions',
                            'is_collapsed': shell_status_code != "running" or app.request.query.get('option_changed') != 'shell', 
                        } %}
                            {% block card_header %}
                                <p class="text-sm opacity-8">
                                    <b>Spawn a root shell access link.</b> A temporary link that expires in a configured amount of time, and can also be closed on-demand. Ideal for quick actions on your edgebox instance, alone or with a someone else via real-time multiplayer interaction.
                                </p>
                            {% endblock %}
                            {% block card_content %}
                                <p class="text-sm opacity-8">
                                    <button type="button" class="btn btn-outline-dark btn-shell-session mr-5" {% if shell_status_code != 'running' %}onclick="startShellSession(this);"{% else %}onclick="window.location.href='{{shell_url}}';"{% endif %}>{% if shell_status_code != 'running' %}Start Shell Session{% else %}Open Shell{% endif %}</button>
                                    <button type="button" class="btn btn-outline-danger btn-shell-stop-session" onclick="stopShellSession(this);" style="{% if shell_status_code != 'running' %}display:none;{% endif %}">Stop Shell Session</button>
                                    <div class="form-group sshx-timeout-group" id="sshx-timeout-settings" style="{% if shell_status_code == 'running' %}display:none;{% endif %}">
                                        <label for="sshx-timeout-value" class="form-control-label">How long should this connection be kept open?</label>
                                        <div class="row">
                                            <div class="col-2">
                                                <input class="form-control" name="sshx-timeout-value" type="number" value="25" id="sshx-timeout-value">
                                            </div>
                                            <div class="col-10" style="margin-top: 5px; margin-left: -4px;">
                                                <span style="padding-top: 12px;"> <b>minutes</b></span>
                                            </div>
                                        </div>
                                    </div>
                                    {% if shell_status_code != 'running' %}
                                        <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                            <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                            <span class="alert-text text-xs text-white"><i><b>Once you click, wait a few seconds while the connection is prepared. A new tab will open where you can use the remote shell.</i></b></span>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                            <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                            <span class="alert-text text-xs text-white"><i><b>Your shell is now available online! Make sure to close it once you don't need it anymore.</i></b></span>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    {% endif %}
                                </p>
                            {% endblock %}
                        {% endembed %}
                        {% embed 'blocks/_collapse_card.html.twig' with { 
                            'title': 'Browser Dev Environment',
                            'collapse_id': 'collapseBrowserDevOptions',
                            'is_collapsed': app.request.query.get('option_changed') != 'browserdev', 
                        } %}
                            {% block card_header %}
                                <p class="text-sm opacity-8">
                                    <b>Access the underlying edgebox system via a full fledged web browser development environment.</b> This is an environment with full access to your edgebox instance. This is ideal for advanced users who want to run, debug, and develop their code and apps on the edgebox instance.
                                </p>
                            {% endblock %}
                            {% block card_content %}
                                <p class="text-sm opacity-8">
                                    <div class="form-group browserdev-password-group" id="browserdev-password-settings" style="">
                                        <label for="sshx-timeout-value" class="form-control-label">Your access password:</label>
                                        <div class="row">
                                            <div class="col-12">
                                                {# <input class="form-control" name="sshx-timeout-value" type="password" value="25" id="sshx-timeout-value"> #}
                                                <div class="input-group">
                                                    <input  type="password" class="form-control btn-tooltip" data-bs-toggle="tooltip" data-bs-placement="top" title="You'll be asked for this password to enter the development environment" data-container="body" data-animation="true" placeholder="Environment Password" value="{{browserdev_status.password}}" id="dev-env-password-input" aria-label="This is the Development Environment Password" aria-describedby="This is the Development Environment Password">
                                                    <button class="btn btn-outline-secondary mb-0" data-input-id="dev-env-password-input" type="button" onclick="toogleAppOptionSecretVisibility(this);">Show</button>
                                                    <button class="btn btn-outline-secondary mb-0 btn-tooltip" data-input-id="dev-env-password-input" type="button" onclick="generateAppOptionsSecret(this);" data-bs-toggle="tooltip" data-bs-placement="top" title="Generate" data-container="body" data-animation="true"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                    <button class="btn btn-outline-secondary mb-0" data-input-id="dev-env-password-input" type="button" onclick="copyAppOptionToClipboard(this);">Copy</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" id="btn-browserdev" class="btn btn-outline-dark btn-browserdev mr-5" {% if browserdev_status.status != 'running' %}onclick="enableBrowserDev(this);"{% else %}onclick="window.open('{{browserdev_status.url}}/?folder=/home/system/components/', '_blank', 'noopener');"{% endif %}>{% if browserdev_status.status != 'running' %}Enable Development Environment{% else %}Open Development Environment{% endif %}</button>
                                    <button type="button" id="btn-browserdev-changepw" class="btn btn-outline-dark btn-browserdev-changepw" onclick="changePwBrowserDev(this);" style="">Change Password</button>
                                    <button type="button" id="btn-browserdev-disable"class="btn btn-outline-danger btn-browserdev-stop" onclick="disableBrowserDev(this);" style="{% if browserdev_status.status != 'running' %}display:none;{% endif %}">Disable Development Environment</button>
                                    {% if browserdev_status.status != 'running' %}
                                        <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                            <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                            <span class="alert-text text-xs text-white"><i><b>Once you click, wait a few seconds while things are prepared. A new tab will open with your development environment.</i></b></span>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-top: -5px;">
                                            <span class="alert-icon"><i class="ni ni-notification-70 text-white"></i></span>
                                            <span class="alert-text text-xs text-white"><i><b>Your development environment is available online! We recommend you disable it when you don't need it.</i></b></span>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    {% endif %}
                                </p>
                            {% endblock %}
                        {% endembed %}
                    </div>
                    <div class="card mt-4">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">System Updates</h6>
                        </div>
                        <div class="card-body p-3">
                            <p class="text-sm opacity-8">Apply system updates to your Edgebox. Updates are released frequently and may include new functionality, applications, or security patches.</p>
                            <!-- Sidebar Backgrounds -->
                            <hr>
                            <div>
                            {% if updates_status.status == 'up_to_date' %}
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder">✅ {{updates_status.status_message}}!</h6>
                                <p class="text-xs">Your system is fully up-to-date. <br>Check the <b><a href="/changelog">changelog</a></b> for the details on your last update.</p>
                            {% else %}
                                <div class="row">
                                    <div class="col-9 col-sm-9">
                                        <h6 class="text-uppercase text-body text-xs font-weight-bolder">⚠️ {{updates_status.status_message}}</h6>
                                        <p class="text-xs">Some components have new releases.</p>
                                    </div>
                                    <div class="col-3 col-sm-3">
                                        <a href="/settings/update_system" class="btn btn-outline-success" >Update Now</a>
                                    </div>
                                </div>
                                <ul class="list-group">
                                    <li class="list-group-item border-0 px-0">
                                        <div class="row">
                                            {% for component in updates_status.value %}
                                    
                                                <div class="col-2 col-sm-2">
                                                    <h6 class="mb-0">{{component.target}}</h6>
                                                    <p class="text-xs">📃 <a target="_blank" href="https://github.com/edgebox-iot/{{component.target}}/releases/tag/{{component.version}}">{{component.version}}</a></p>
                                                </div>
                                                
                                            {% endfor %}
                                        </div>
                                    </li>
                                </ul>
                                <p class="text-xs">ℹ️ Tap the version numbers to see details on what changed since the last update.</p>
                            {% endif %}
                            </div>
                        <div>
                    </div>
                </div>

                {# <div class="col-12 col-xl-4" style="margin-top: 25px;">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-0">System Information</h6>
                        </div>
                        <div class="card-body p-3">
                            <ul class="list-group">
                                <li class="list-group-item border-0 px-0">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="card bg-cover text-center" style="background-image: url('/assets/img/coming-soon-bg.jpg')">
                                                <div class="card-body z-index-2 py-9">
                                                    <h4 class="text-white">Coming Soon</h2>
                                                        <p class="text-white">
                                                            Your current version still does not support this feature. We are working to bring it as fast as possible. <a href="https://github.com/edgebox-iot/contribute" target="_blank">Want to help? You can!</a>
                                                        </p>
                                                </div>
                                                <div class="mask bg-gradient-primary border-radius-lg"></div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div> #}

            </div>
        </div>
    </div>


{% endblock content %}
