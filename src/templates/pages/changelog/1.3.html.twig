	{% extends 'base_security.html.twig' %}

	{% block title %}Changelog - Edgebox
	{% endblock %}
	{% block content %}
		<section class="min-vh-100 mb-8">
			<div class="page-header align-items-start min-vh-30 pt-5 pb-11 m-3 border-radius-lg" style="background-image: url('../assets/img/curved-images/curved14.jpg');">
				<span class="mask bg-gradient-dark opacity-6"></span>
				<div class="container">
					<div class="row justify-content-center">
						<div class="container-fluid py-4">
							<div class="row">
								<div class="col-12 text-center">
									<img src="../assets/img/logo_transparent_horizontal_300x100.png" class="border-radius-lg" alt="team-2" style="filter: brightness(0) invert(1);">
									<h3 class="mt-5 text-white">The Changelog üöö</h3>
									<h5 class="text-secondary font-weight-normal text-white"><b>A new update ({{ target_version }}) just landed!</b> <br>Here's the fixes and improvements we've been working on:</h5>

									<div class="multisteps-form mb-5">

										<div class="row">
											<div class="col-12 col-lg-12 mx-auto my-5">
												<div class="onboarding-progress">
													<button class="onboarding-btn btn btn-secondary js-active" data-step="1" type="button" title="User Info">
														<span>Web Browser Dev Environment</span>
													</button>
													<button class="onboarding-btn btn btn-secondary" data-step="2" type="button" title="Address">
														<span>New Apps</span>
													</button>
													<button class="onboarding-btn btn btn-secondary" data-step="3" type="button" title="Order Info">
														<span>Improvements and Fixes</span>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="container">
				<div class="onboarding-cards" style="margin-top: -300px;">
					<div class="row onboarding-card" id="onboarding-card-1">
						<div class="card col-12 col-lg-12 m-auto">
							<div class="card-body">
								<div class="row mt-5">
									<div class="col-lg-12 col-md-12 d-flex justify-content-center flex-column">
										<h1 class="text-gradient text-primary">
											A Code Editor and Development Environment
										</h1>
										<h1 class="mb-4">
											In your browser, Anywhere you are ‚ú®
										</h1>
										<p class="lead pe-5 me-5"></p>
										<p>
											<b>‚úÖ A new browser-powered full fledged development environment is now available for you to use!</b>
											<br>
											<ul><li>Imagine having access to your IDE where you can code new things, together with full control of your apps and data, using any computer with only a browser. Our <b>Browser Development environment gives you just that.</b></li>
											<li><b>With a tap of a button, </b> you can enable and disable this development environment. Just look for the new option in the <b><a href="/settings/?option_changed=browserdev" target="_blank">Advanced Settings</a></b>.</li>
											<li>You can also access this development environment in the context of a single Edgeapp. <b>When the browser dev environment is enabled, look for a new button the Edgeapp details/options page</b>.</li></ul></p>
										</p>
										<p>We hope you like it, and can't wait to know what you do with this new power! ü§© <i>You can also do this anytime later by finding it on the dashboard settings page üëá</i></p>
										<div class="row">
											<div class="col-lg-12">
												<div class="image-grid">
													<img src="../assets/img/changelog-assets/screenshot_2024-12-06_1.jpeg" class="img-fluid" style="border-radius: 10px;" alt="team-2">
													<img src="../assets/img/changelog-assets/screenshot_2024-12-06_2.jpeg" class="img-fluid" style="border-radius: 10px;" alt="team-2">
													<img src="../assets/img/changelog-assets/screenshot_2024-12-06_3.jpeg" class="img-fluid" style="border-radius: 10px;" alt="team-2">
												</div>
											</div>
										</div>
										<style>
										.image-grid {
											display: flex;
											justify-content: space-between;
											margin-top: 20px;
										}

										.image-grid img {
											margin: 0 10px;
											height: 280px; /* Arbitrary height */
										}

										/* .image-grid img:not(:first-child) {
											margin-left: -500px;
										} */

										@media (max-width: 991px) {
											.image-grid {
												flex-direction: column;
												align-items: center;
											}

											.image-grid img:not(:first-child) {
												margin-left: 0;
												margin-top: -100px; /* Add top margin on mobile */
											}
										}
										</style>

										<br>
									</div>
								</div>
								<div class="row">
									<div class="col col-lg-2">
										
									</div>
									<div class="col col-lg-8">
									</div>
									<div class="col col-lg-2 d-flex justify-content-end">
										<button class="btn btn-primary" onclick="navigateStep(1)">Next</button>
									</div>
								</div>

							</div>

						</div>
					</div>
					<div class="row onboarding-card" id="onboarding-card-2">
						<div class="card col-12 col-lg-12 m-auto">
							
							<div class="card-body">
								<div class="row mt-5">
									<div class="col-lg-12 col-md-12 d-flex justify-content-center flex-column">
										<h1 class="text-gradient text-primary">
											Anywhere and Anytime
										</h1>
										<h1 class="mb-4">
											Sync Files Like a Pro! üöÄ
										</h1>
										<p class="lead pe-5 me-5"></p>
										<p>
											<br>
											<b>This update brings only one new app....</b>
											<br>
											But this is an incredibly powerful one. Besides, this app package was created with the "hello" template as base, using the new development environment! üéâ
											<br>
											<br>
											<b>Just üëá tap the card if you want to have it installed after this.</b>
										</p>
										<br>
										
									</div>
								</div>
						
								<div class="selection-grid">
									<div class="select-card" id="install-card-openwebui" onclick="toggleSelection(this)" data-app-id="syncthing">
										<span class="card-text"><b>Syncthing</b> is a continuous file synchronization program. It synchronizes files between two or more computers/mobiles in real time, safely protected from prying eyes. Your data is your data alone and you deserve to choose where it is stored, whether it is shared with some third party, and how it's transmitted over the internet.</span>
										<div class="bg-gradient-{{ dashboard_settings.color_mood }} border-radius-lg h-100" style="max-width: 100px; max-height: 90px; float: right;">
											<div class="position-relative d-flex align-items-center justify-content-center h-100">
												<img class="w-100 position-relative z-index-2" src="../assets/img/edgeapps/syncthing.png">
											</div>
										</div>
									</div>
									<!-- Add more cards as needed -->
								</div>

								<div class="row mt-5">
									<div class="col col-lg-2">
										<button class="btn btn-secondary" onclick="navigateStep(-1)">Back</button>
									</div>
									<div class="col col-lg-8">
									</div>
									<div class="col col-lg-2 d-flex justify-content-end">
										<button class="btn btn-primary" onclick="navigateStep(1)">Next</button>
									</div>
								</div>
							</div>

							<style>
							.selection-grid {
								display: grid;
								grid-template-columns: repeat(2, 1fr);
								gap: 1rem;
							}

							@media (max-width: 768px) {
								.selection-grid {
									grid-template-columns: 1fr;
								}
							}

							.select-card {
								display: flex;
								justify-content: space-between;
								align-items: right;
								padding: 1rem;
								border: 2px solid #ddd;
								border-radius: 8px;
								cursor: pointer;
								transition: all 0.3s ease;
							}

							.select-card:hover {
								border-color: #007bff;
							}

							.select-card.selected {
								background-image: linear-gradient(310deg, #7928CA, #FF0080);
								-webkit-background-clip: text;
								-webkit-text-fill-color: transparent;
								color: white;
								border-color: #0056b3;
							}

							.card-text {
								margin-right: 1rem;
							}
							</style>

							{# <script>
							function toggleSelection(element) {
								element.classList.toggle('selected');
							}
							</script> #}

						</div>
					</div>
					<div class="row onboarding-card" id="onboarding-card-3">
						<div class="card col-12 col-lg-12 m-auto">
							<div class="card-body">
								<div class="row mt-5">
									<div class="col-lg-12 col-md-12 d-flex justify-content-center flex-column">
										<h1 class="text-gradient text-primary">
											Improvements and Fixes
										</h1>
										<h1 class="mb-4">
											for a better experience üéâ
										</h1>
										<p class="lead pe-5 me-5"></p>
										<p>
											<b>Version 1.3 is a big internal update, and we cleaned a lot of ground on capabilities, stability and details!</b>
											<p>Launching future updates is going to be easier and faster, and we're excited to focus our efforts across the next minor verions towards cleaning and make Edgebox even more practical, secure, and robust. Here's what we've done so far:</p>
											<br>
											<br>
											<b>üèóÔ∏è Creating new apps from templates:</b>
											<ul>
												<li>
													<b>we start our journey through the devyoelopment environment with much improved tooling to run and work with Edgebox in a development setting.</b><br>You can now scaffold a new Edgeapp from a set of templates, using the browser dev environment tasks existing when you open in the apps path (<i>/home/system/components/apps/</i>). For this release there is only a "hello" template, but we're working on more.
												</li>
											</ul>
											<b>üëÄ A bunch of new development tasks to help you with your development:</b>
											<ul>
												<li>
													<b>Edgeapps can now have a tasks file that can help you easily run them and modify them in the Browser Development Environment!</b>, using Cmd/Crtl+Shift+P and selecting the "Run Task" command to choose waht task to run.
												</li>
												<li>
													<b>The same tasks system exists across all internal edgebox core modules</b>, so its easier than ever to contribute back to the project.
												</li>
												<li>
													<b>Future minor updates will continue introducing new tasks and ways to facilitate developing things using Edgebox.</b>
												</li>
											</ul>
											
											{# <div class="row">
												<div class="col-lg-10">
													<div class="image-grid">
														<img src="../assets/img/hello-assets/screenshot_2024-11-02_10.35.23.png" class="img-fluid" alt="team-2">
														<img src="../assets/img/changelog-assets/screenshot_2024-11-02_21.58.39.png" class="img-fluid" alt="team-2">
														<img src="../assets/img/changelog-assets/screenshot_2024-11-02_10.28.39.png" class="img-fluid" alt="team-2">
													</div>
												</div>
											</div> #}

											<b>ü™≤ We also fixed some things to simplify Edgebox:</b>
											<ul>
												<li>
													We improved the experience of the advanced settings section collapsible cards to open when tapping on either the title or the explanatory subtitle.
												</li>
												<li>
													We've fixed some issues we've found with the system control service when developing the browser dev environment. 
												</li>
												<li>
													We've made several improvements to the Edgeapps framework around postinstall scripts and app file structure to support the bootstrap tool and have a better overall experience of developing and running Edgeapps. 
												</li>
												<li>
													We've updated the updater module to better detect the current version and available new versions. This module now supports finding when you are running a development version of a module, and detect + update to pre-releases and beta versions.
												</li>
											</ul>
										</p>
										<br>
									</div>
								</div>
								<div class="row">
									<div class="col col-lg-2">
										<button class="btn btn-secondary" onclick="navigateStep(-1)">Back</button>
									</div>
									<div class="col col-lg-7">
									</div>
									<div class="col col-lg-3 d-flex justify-content-end">
										<button onclick="finishOnboarding()" class="btn btn-primary">Finish</a>
									</div>
								</div>

							</div>

						</div>
					</div>
				</div>
				<style>
				.onboarding-card {
					display: none;
				}

				.onboarding-card.active {
					display: block;
				}

				.onboarding-btn.js-active {
					background-color: #fff;
					color: #000;
				}
				</style>
				<script>
					let currentStep = 1;
					const totalSteps = 3;

					function navigateStep(direction) {
						const newStep = currentStep + direction;
						if (newStep >= 1 && newStep <= totalSteps) {
							// Hide current card
							document.getElementById(`onboarding-card-${currentStep}`).classList.remove('active');
							
							// Show new card
							document.getElementById(`onboarding-card-${newStep}`).classList.add('active');
							
							// Update progress buttons
							updateProgressButtons(newStep);
							
							// Update navigation buttons
							currentStep = newStep;
							updateNavigationButtons();

							// Scroll the user up to the top of the page
							window.scrollTo(0, 0);
						}
					}

					function updateProgressButtons(step) {
						document.querySelectorAll('.onboarding-btn').forEach(btn => {
							btn.classList.remove('js-active', 'btn-white');
							btn.classList.add('btn-secondary');
						});
						
						const activeBtn = document.querySelector(`.onboarding-btn[data-step="${step}"]`);
						activeBtn.classList.remove('btn-secondary');
						activeBtn.classList.add('js-active', 'btn-white');
					}

					function updateNavigationButtons() {
						// document.getElementById('prevBtn').style.display = currentStep === 1 ? 'none' : 'block';
						// document.getElementById('nextBtn').textContent = currentStep === totalSteps ? 'Finish' : 'Next';
					}

					// Allow clicking on progress buttons
					document.querySelectorAll('.onboarding-btn').forEach(btn => {
						btn.addEventListener('click', () => {
							const targetStep = parseInt(btn.dataset.step);
							const direction = targetStep - currentStep;
							navigateStep(direction);
						});
					});

					navigateStep(0);
				</script>
			</div>
			<br>
			<hr>
			<div class="row align-items-center justify-content-center">
				<div class="col-lg-6 mb-lg-0 mb-4">
					<div class="copyright text-center text-muted">
					¬© <script>
						document.write(new Date().getFullYear())
					</script>,
					made with ‚ù§Ô∏è for a more private web.
					</div>
				</div>
			</div>
		</section>

		<script>
			let selectedCards = [];

			function toggleSelection(element) {
				element.classList.toggle('selected');
				const cardId = element.getAttribute('data-app-id');
				
				if (element.classList.contains('selected')) {
					selectedCards.push(cardId);
				} else {
					selectedCards = selectedCards.filter(id => id !== cardId);
				}
			}

			function finishOnboarding() {
				if (selectedCards.length === 0) {
					window.location.href = '/';
				} else {
					fetch('/api/edgeapps', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({
							op: 'install_bulk_edgeapps',
							ids: selectedCards
						})
					})
					.then(response => response.json())
					.then(data => {
						// Redirect to dashboard or show success message
						window.location.href = '/';
						console.log(data);
					})
					.catch(error => {
						// console.error('Error:', error);
						window.location.href = '/';
					});
				}
			}
		</script>

	{% endblock content %}
